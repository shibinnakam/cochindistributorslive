{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { CompressedArrayTexture, CompressedCubeTexture, CompressedTexture, Data3DTexture, DataTexture, FileLoader, FloatType, HalfFloatType, LinearFilter, LinearMipmapLinearFilter, NearestFilter, NearestMipmapNearestFilter, LinearSRGBColorSpace, Loader, NoColorSpace, RGBAFormat, RGBA_ASTC_4x4_Format, RGBA_ASTC_6x6_Format, RGBA_BPTC_Format, RGBA_S3TC_DXT3_Format, RGBA_ETC2_EAC_Format, R11_EAC_Format, SIGNED_R11_EAC_Format, RG11_EAC_Format, SIGNED_RG11_EAC_Format, RGBA_PVRTC_4BPPV1_Format, RGBA_PVRTC_2BPPV1_Format, RGBA_S3TC_DXT1_Format, RGBA_S3TC_DXT5_Format, RGB_BPTC_UNSIGNED_Format, RGB_ETC1_Format, RGB_ETC2_Format, RGB_PVRTC_4BPPV1_Format, RGB_S3TC_DXT1_Format, SIGNED_RED_GREEN_RGTC2_Format, SIGNED_RED_RGTC1_Format, RED_GREEN_RGTC2_Format, RED_RGTC1_Format, RGBFormat, RGFormat, RedFormat, SRGBColorSpace, UnsignedByteType, UnsignedInt5999Type, UnsignedInt101111Type } from 'three';\nimport { WorkerPool } from '../utils/WorkerPool.js';\nimport { read, KHR_DF_FLAG_ALPHA_PREMULTIPLIED, KHR_DF_PRIMARIES_BT709, KHR_DF_PRIMARIES_DISPLAYP3, KHR_DF_PRIMARIES_UNSPECIFIED, KHR_DF_TRANSFER_SRGB, KHR_SUPERCOMPRESSION_NONE, KHR_SUPERCOMPRESSION_ZSTD, VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_4x4_SRGB_BLOCK, VK_FORMAT_ASTC_4x4_UNORM_BLOCK, VK_FORMAT_ASTC_6x6_SRGB_BLOCK, VK_FORMAT_ASTC_6x6_UNORM_BLOCK, VK_FORMAT_BC1_RGBA_SRGB_BLOCK, VK_FORMAT_BC1_RGBA_UNORM_BLOCK, VK_FORMAT_BC1_RGB_SRGB_BLOCK, VK_FORMAT_BC1_RGB_UNORM_BLOCK, VK_FORMAT_BC3_SRGB_BLOCK, VK_FORMAT_BC3_UNORM_BLOCK, VK_FORMAT_BC4_SNORM_BLOCK, VK_FORMAT_BC4_UNORM_BLOCK, VK_FORMAT_BC5_SNORM_BLOCK, VK_FORMAT_BC5_UNORM_BLOCK, VK_FORMAT_BC7_SRGB_BLOCK, VK_FORMAT_BC7_UNORM_BLOCK, VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK, VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK, VK_FORMAT_EAC_R11_UNORM_BLOCK, VK_FORMAT_EAC_R11_SNORM_BLOCK, VK_FORMAT_EAC_R11G11_UNORM_BLOCK, VK_FORMAT_EAC_R11G11_SNORM_BLOCK, VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG, VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG, VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG, VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG, VK_FORMAT_R16G16B16A16_SFLOAT, VK_FORMAT_R16G16_SFLOAT, VK_FORMAT_R16_SFLOAT, VK_FORMAT_R32G32B32A32_SFLOAT, VK_FORMAT_R32G32_SFLOAT, VK_FORMAT_R32_SFLOAT, VK_FORMAT_R8G8B8A8_SRGB, VK_FORMAT_R8G8B8A8_UNORM, VK_FORMAT_R8G8_SRGB, VK_FORMAT_R8G8_UNORM, VK_FORMAT_R8_SRGB, VK_FORMAT_R8_UNORM, VK_FORMAT_E5B9G9R9_UFLOAT_PACK32, VK_FORMAT_B10G11R11_UFLOAT_PACK32, VK_FORMAT_UNDEFINED } from '../libs/ktx-parse.module.js';\nimport { ZSTDDecoder } from '../libs/zstddec.module.js';\nimport { DisplayP3ColorSpace, LinearDisplayP3ColorSpace } from '../math/ColorSpaces.js';\nconst _taskCache = new WeakMap();\nlet _activeLoaders = 0;\nlet _zstd;\n\n/**\n * A loader for KTX 2.0 GPU Texture containers.\n *\n * KTX 2.0 is a container format for various GPU texture formats. The loader supports Basis Universal GPU textures,\n * which can be quickly transcoded to a wide variety of GPU texture compression formats. While KTX 2.0 also allows\n * other hardware-specific formats, this loader does not yet parse them.\n *\n * This loader parses the KTX 2.0 container and transcodes to a supported GPU compressed texture format.\n * The required WASM transcoder and JS wrapper are available from the `examples/jsm/libs/basis` directory.\n *\n * This loader relies on Web Assembly which is not supported in older browsers.\n *\n * References:\n * - [KTX specification](http://github.khronos.org/KTX-Specification/)\n * - [DFD](https://www.khronos.org/registry/DataFormat/specs/1.3/dataformat.1.3.html#basicdescriptor)\n * - [BasisU HDR](https://github.com/BinomialLLC/basis_universal/wiki/UASTC-HDR-Texture-Specification-v1.0)\n *\n * ```js\n * const loader = new KTX2Loader();\n * loader.setTranscoderPath( 'examples/jsm/libs/basis/' );\n * loader.detectSupport( renderer );\n * const texture = loader.loadAsync( 'diffuse.ktx2' );\n * ```\n *\n * @augments Loader\n * @three_import import { KTX2Loader } from 'three/addons/loaders/KTX2Loader.js';\n */\nclass KTX2Loader extends Loader {\n  /**\n   * Constructs a new KTX2 loader.\n   *\n   * @param {LoadingManager} [manager] - The loading manager.\n   */\n  constructor(manager) {\n    super(manager);\n    this.transcoderPath = '';\n    this.transcoderBinary = null;\n    this.transcoderPending = null;\n    this.workerPool = new WorkerPool();\n    this.workerSourceURL = '';\n    this.workerConfig = null;\n    if (typeof MSC_TRANSCODER !== 'undefined') {\n      console.warn('THREE.KTX2Loader: Please update to latest \"basis_transcoder\".' + ' \"msc_basis_transcoder\" is no longer supported in three.js r125+.');\n    }\n  }\n\n  /**\n   * Sets the transcoder path.\n   *\n   * The WASM transcoder and JS wrapper are available from the `examples/jsm/libs/basis` directory.\n   *\n   * @param {string} path - The transcoder path to set.\n   * @return {KTX2Loader} A reference to this loader.\n   */\n  setTranscoderPath(path) {\n    this.transcoderPath = path;\n    return this;\n  }\n\n  /**\n   * Sets the maximum number of Web Workers to be allocated by this instance.\n   *\n   * @param {number} workerLimit - The worker limit.\n   * @return {KTX2Loader} A reference to this loader.\n   */\n  setWorkerLimit(workerLimit) {\n    this.workerPool.setWorkerLimit(workerLimit);\n    return this;\n  }\n\n  /**\n   * Async version of {@link KTX2Loader#detectSupport}.\n   *\n   * @async\n   * @deprecated\n   * @param {WebGPURenderer} renderer - The renderer.\n   * @return {Promise} A Promise that resolves when the support has been detected.\n   */\n  async detectSupportAsync(renderer) {\n    console.warn('KTX2Loader: \"detectSupportAsync()\" has been deprecated. Use \"detectSupport()\" and \"await renderer.init();\" when creating the renderer.'); // @deprecated r181\n\n    await renderer.init();\n    return this.detectSupport(renderer);\n  }\n\n  /**\n   * Detects hardware support for available compressed texture formats, to determine\n   * the output format for the transcoder. Must be called before loading a texture.\n   *\n   * @param {WebGPURenderer|WebGLRenderer} renderer - The renderer.\n   * @return {KTX2Loader} A reference to this loader.\n   */\n  detectSupport(renderer) {\n    if (renderer.isWebGPURenderer === true) {\n      this.workerConfig = {\n        astcSupported: renderer.hasFeature('texture-compression-astc'),\n        astcHDRSupported: false,\n        // https://github.com/gpuweb/gpuweb/issues/3856\n        etc1Supported: renderer.hasFeature('texture-compression-etc1'),\n        etc2Supported: renderer.hasFeature('texture-compression-etc2'),\n        dxtSupported: renderer.hasFeature('texture-compression-s3tc'),\n        bptcSupported: renderer.hasFeature('texture-compression-bc'),\n        pvrtcSupported: renderer.hasFeature('texture-compression-pvrtc')\n      };\n    } else {\n      this.workerConfig = {\n        astcSupported: renderer.extensions.has('WEBGL_compressed_texture_astc'),\n        astcHDRSupported: renderer.extensions.has('WEBGL_compressed_texture_astc') && renderer.extensions.get('WEBGL_compressed_texture_astc').getSupportedProfiles().includes('hdr'),\n        etc1Supported: renderer.extensions.has('WEBGL_compressed_texture_etc1'),\n        etc2Supported: renderer.extensions.has('WEBGL_compressed_texture_etc'),\n        dxtSupported: renderer.extensions.has('WEBGL_compressed_texture_s3tc'),\n        bptcSupported: renderer.extensions.has('EXT_texture_compression_bptc'),\n        pvrtcSupported: renderer.extensions.has('WEBGL_compressed_texture_pvrtc') || renderer.extensions.has('WEBKIT_WEBGL_compressed_texture_pvrtc')\n      };\n      if (typeof navigator !== 'undefined' && navigator.platform.indexOf('Linux') >= 0 && navigator.userAgent.indexOf('Firefox') >= 0 && this.workerConfig.astcSupported && this.workerConfig.etc2Supported && this.workerConfig.bptcSupported && this.workerConfig.dxtSupported) {\n        // On Linux, Mesa drivers for AMD and Intel GPUs expose ETC2 and ASTC even though the hardware doesn't support these.\n        // Using these extensions will result in expensive software decompression on the main thread inside the driver, causing performance issues.\n        // When using ANGLE (e.g. via Chrome), these extensions are not exposed except for some specific Intel GPU models - however, Firefox doesn't perform this filtering.\n        // Since a granular filter is a little too fragile and we can transcode into other GPU formats, disable formats that are likely to be emulated.\n\n        this.workerConfig.astcSupported = false;\n        this.workerConfig.etc2Supported = false;\n      }\n    }\n    return this;\n  }\n\n  // TODO: Make this method private\n\n  init() {\n    if (!this.transcoderPending) {\n      // Load transcoder wrapper.\n      const jsLoader = new FileLoader(this.manager);\n      jsLoader.setPath(this.transcoderPath);\n      jsLoader.setWithCredentials(this.withCredentials);\n      const jsContent = jsLoader.loadAsync('basis_transcoder.js');\n\n      // Load transcoder WASM binary.\n      const binaryLoader = new FileLoader(this.manager);\n      binaryLoader.setPath(this.transcoderPath);\n      binaryLoader.setResponseType('arraybuffer');\n      binaryLoader.setWithCredentials(this.withCredentials);\n      const binaryContent = binaryLoader.loadAsync('basis_transcoder.wasm');\n      this.transcoderPending = Promise.all([jsContent, binaryContent]).then(([jsContent, binaryContent]) => {\n        const fn = KTX2Loader.BasisWorker.toString();\n        const body = ['/* constants */', 'let _EngineFormat = ' + JSON.stringify(KTX2Loader.EngineFormat), 'let _EngineType = ' + JSON.stringify(KTX2Loader.EngineType), 'let _TranscoderFormat = ' + JSON.stringify(KTX2Loader.TranscoderFormat), 'let _BasisFormat = ' + JSON.stringify(KTX2Loader.BasisFormat), '/* basis_transcoder.js */', jsContent, '/* worker */', fn.substring(fn.indexOf('{') + 1, fn.lastIndexOf('}'))].join('\\n');\n        this.workerSourceURL = URL.createObjectURL(new Blob([body]));\n        this.transcoderBinary = binaryContent;\n        this.workerPool.setWorkerCreator(() => {\n          const worker = new Worker(this.workerSourceURL);\n          const transcoderBinary = this.transcoderBinary.slice(0);\n          worker.postMessage({\n            type: 'init',\n            config: this.workerConfig,\n            transcoderBinary\n          }, [transcoderBinary]);\n          return worker;\n        });\n      });\n      if (_activeLoaders > 0) {\n        // Each instance loads a transcoder and allocates workers, increasing network and memory cost.\n\n        console.warn('THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues.' + ' Use a single KTX2Loader instance, or call .dispose() on old instances.');\n      }\n      _activeLoaders++;\n    }\n    return this.transcoderPending;\n  }\n\n  /**\n   * Starts loading from the given URL and passes the loaded KTX2 texture\n   * to the `onLoad()` callback.\n   *\n   * @param {string} url - The path/URL of the file to be loaded. This can also be a data URI.\n   * @param {function(CompressedTexture)} onLoad - Executed when the loading process has been finished.\n   * @param {onProgressCallback} onProgress - Executed while the loading is in progress.\n   * @param {onErrorCallback} onError - Executed when errors occur.\n   */\n  load(url, onLoad, onProgress, onError) {\n    if (this.workerConfig === null) {\n      throw new Error('THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.');\n    }\n    const loader = new FileLoader(this.manager);\n    loader.setPath(this.path);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.setWithCredentials(this.withCredentials);\n    loader.setRequestHeader(this.requestHeader);\n    loader.setResponseType('arraybuffer');\n    loader.load(url, buffer => {\n      this.parse(buffer, onLoad, onError);\n    }, onProgress, onError);\n  }\n\n  /**\n   * Parses the given KTX2 data.\n   *\n   * @param {ArrayBuffer} buffer - The raw KTX2 data as an array buffer.\n   * @param {function(CompressedTexture)} onLoad - Executed when the loading/parsing process has been finished.\n   * @param {onErrorCallback} onError - Executed when errors occur.\n   * @returns {Promise} A Promise that resolves when the parsing has been finished.\n   */\n  parse(buffer, onLoad, onError) {\n    if (this.workerConfig === null) {\n      throw new Error('THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.');\n    }\n\n    // Check for an existing task using this buffer. A transferred buffer cannot be transferred\n    // again from this thread.\n    if (_taskCache.has(buffer)) {\n      const cachedTask = _taskCache.get(buffer);\n      return cachedTask.promise.then(onLoad).catch(onError);\n    }\n    this._createTexture(buffer).then(texture => onLoad ? onLoad(texture) : null).catch(onError);\n  }\n  _createTextureFrom(transcodeResult, container) {\n    const {\n      type: messageType,\n      error,\n      data: {\n        faces,\n        width,\n        height,\n        format,\n        type,\n        dfdFlags\n      }\n    } = transcodeResult;\n    if (messageType === 'error') return Promise.reject(error);\n    let texture;\n    if (container.faceCount === 6) {\n      texture = new CompressedCubeTexture(faces, format, type);\n    } else {\n      const mipmaps = faces[0].mipmaps;\n      texture = container.layerCount > 1 ? new CompressedArrayTexture(mipmaps, width, height, container.layerCount, format, type) : new CompressedTexture(mipmaps, width, height, format, type);\n    }\n    texture.minFilter = faces[0].mipmaps.length === 1 ? LinearFilter : LinearMipmapLinearFilter;\n    texture.magFilter = LinearFilter;\n    texture.generateMipmaps = false;\n    texture.needsUpdate = true;\n    texture.colorSpace = parseColorSpace(container);\n    texture.premultiplyAlpha = !!(dfdFlags & KHR_DF_FLAG_ALPHA_PREMULTIPLIED);\n    return texture;\n  }\n\n  /**\n   * @private\n   * @param {ArrayBuffer} buffer\n   * @param {?Object} config\n   * @return {Promise<CompressedTexture|CompressedArrayTexture|DataTexture|Data3DTexture>}\n   */\n  async _createTexture(buffer, config = {}) {\n    const container = read(new Uint8Array(buffer));\n\n    // Basis UASTC HDR is a subset of ASTC, which can be transcoded efficiently\n    // to BC6H. To detect whether a KTX2 file uses Basis UASTC HDR, or default\n    // ASTC, inspect the DFD color model.\n    //\n    // Source: https://github.com/BinomialLLC/basis_universal/issues/381\n    const isBasisHDR = container.vkFormat === VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT && container.dataFormatDescriptor[0].colorModel === 0xA7;\n\n    // If the device supports ASTC, Basis UASTC HDR requires no transcoder.\n    const needsTranscoder = container.vkFormat === VK_FORMAT_UNDEFINED || isBasisHDR && !this.workerConfig.astcHDRSupported;\n    if (!needsTranscoder) {\n      return createRawTexture(container);\n    }\n\n    //\n    const taskConfig = config;\n    const texturePending = this.init().then(() => {\n      return this.workerPool.postMessage({\n        type: 'transcode',\n        buffer,\n        taskConfig: taskConfig\n      }, [buffer]);\n    }).then(e => this._createTextureFrom(e.data, container));\n\n    // Cache the task result.\n    _taskCache.set(buffer, {\n      promise: texturePending\n    });\n    return texturePending;\n  }\n\n  /**\n   * Frees internal resources. This method should be called\n   * when the loader is no longer required.\n   */\n  dispose() {\n    this.workerPool.dispose();\n    if (this.workerSourceURL) URL.revokeObjectURL(this.workerSourceURL);\n    _activeLoaders--;\n  }\n}\n\n/* CONSTANTS */\n\nKTX2Loader.BasisFormat = {\n  ETC1S: 0,\n  UASTC: 1,\n  UASTC_HDR: 2\n};\n\n// Source: https://github.com/BinomialLLC/basis_universal/blob/master/webgl/texture_test/index.html\nKTX2Loader.TranscoderFormat = {\n  ETC1: 0,\n  ETC2: 1,\n  BC1: 2,\n  BC3: 3,\n  BC4: 4,\n  BC5: 5,\n  BC7_M6_OPAQUE_ONLY: 6,\n  BC7_M5: 7,\n  PVRTC1_4_RGB: 8,\n  PVRTC1_4_RGBA: 9,\n  ASTC_4x4: 10,\n  ATC_RGB: 11,\n  ATC_RGBA_INTERPOLATED_ALPHA: 12,\n  RGBA32: 13,\n  RGB565: 14,\n  BGR565: 15,\n  RGBA4444: 16,\n  BC6H: 22,\n  RGB_HALF: 24,\n  RGBA_HALF: 25\n};\nKTX2Loader.EngineFormat = {\n  RGBAFormat: RGBAFormat,\n  RGBA_ASTC_4x4_Format: RGBA_ASTC_4x4_Format,\n  RGB_BPTC_UNSIGNED_Format: RGB_BPTC_UNSIGNED_Format,\n  RGBA_BPTC_Format: RGBA_BPTC_Format,\n  RGBA_ETC2_EAC_Format: RGBA_ETC2_EAC_Format,\n  RGBA_PVRTC_4BPPV1_Format: RGBA_PVRTC_4BPPV1_Format,\n  RGBA_S3TC_DXT5_Format: RGBA_S3TC_DXT5_Format,\n  RGB_ETC1_Format: RGB_ETC1_Format,\n  RGB_ETC2_Format: RGB_ETC2_Format,\n  RGB_PVRTC_4BPPV1_Format: RGB_PVRTC_4BPPV1_Format,\n  RGBA_S3TC_DXT1_Format: RGBA_S3TC_DXT1_Format\n};\nKTX2Loader.EngineType = {\n  UnsignedByteType: UnsignedByteType,\n  HalfFloatType: HalfFloatType,\n  FloatType: FloatType\n};\n\n/* WEB WORKER */\n\nKTX2Loader.BasisWorker = function () {\n  let config;\n  let transcoderPending;\n  let BasisModule;\n  const EngineFormat = _EngineFormat; // eslint-disable-line no-undef\n  const EngineType = _EngineType; // eslint-disable-line no-undef\n  const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef\n  const BasisFormat = _BasisFormat; // eslint-disable-line no-undef\n\n  self.addEventListener('message', function (e) {\n    const message = e.data;\n    switch (message.type) {\n      case 'init':\n        config = message.config;\n        init(message.transcoderBinary);\n        break;\n      case 'transcode':\n        transcoderPending.then(() => {\n          try {\n            const {\n              faces,\n              buffers,\n              width,\n              height,\n              hasAlpha,\n              format,\n              type,\n              dfdFlags\n            } = transcode(message.buffer);\n            self.postMessage({\n              type: 'transcode',\n              id: message.id,\n              data: {\n                faces,\n                width,\n                height,\n                hasAlpha,\n                format,\n                type,\n                dfdFlags\n              }\n            }, buffers);\n          } catch (error) {\n            console.error(error);\n            self.postMessage({\n              type: 'error',\n              id: message.id,\n              error: error.message\n            });\n          }\n        });\n        break;\n    }\n  });\n  function init(wasmBinary) {\n    transcoderPending = new Promise(resolve => {\n      BasisModule = {\n        wasmBinary,\n        onRuntimeInitialized: resolve\n      };\n      BASIS(BasisModule); // eslint-disable-line no-undef\n    }).then(() => {\n      BasisModule.initializeBasis();\n      if (BasisModule.KTX2File === undefined) {\n        console.warn('THREE.KTX2Loader: Please update Basis Universal transcoder.');\n      }\n    });\n  }\n  function transcode(buffer) {\n    const ktx2File = new BasisModule.KTX2File(new Uint8Array(buffer));\n    function cleanup() {\n      ktx2File.close();\n      ktx2File.delete();\n    }\n    if (!ktx2File.isValid()) {\n      cleanup();\n      throw new Error('THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file');\n    }\n    let basisFormat;\n    if (ktx2File.isUASTC()) {\n      basisFormat = BasisFormat.UASTC;\n    } else if (ktx2File.isETC1S()) {\n      basisFormat = BasisFormat.ETC1S;\n    } else if (ktx2File.isHDR()) {\n      basisFormat = BasisFormat.UASTC_HDR;\n    } else {\n      throw new Error('THREE.KTX2Loader: Unknown Basis encoding');\n    }\n    const width = ktx2File.getWidth();\n    const height = ktx2File.getHeight();\n    const layerCount = ktx2File.getLayers() || 1;\n    const levelCount = ktx2File.getLevels();\n    const faceCount = ktx2File.getFaces();\n    const hasAlpha = ktx2File.getHasAlpha();\n    const dfdFlags = ktx2File.getDFDFlags();\n    const {\n      transcoderFormat,\n      engineFormat,\n      engineType\n    } = getTranscoderFormat(basisFormat, width, height, hasAlpha);\n    if (!width || !height || !levelCount) {\n      cleanup();\n      throw new Error('THREE.KTX2Loader:\tInvalid texture');\n    }\n    if (!ktx2File.startTranscoding()) {\n      cleanup();\n      throw new Error('THREE.KTX2Loader: .startTranscoding failed');\n    }\n    const faces = [];\n    const buffers = [];\n    for (let face = 0; face < faceCount; face++) {\n      const mipmaps = [];\n      for (let mip = 0; mip < levelCount; mip++) {\n        const layerMips = [];\n        let mipWidth, mipHeight;\n        for (let layer = 0; layer < layerCount; layer++) {\n          const levelInfo = ktx2File.getImageLevelInfo(mip, layer, face);\n          if (face === 0 && mip === 0 && layer === 0 && (levelInfo.origWidth % 4 !== 0 || levelInfo.origHeight % 4 !== 0)) {\n            console.warn('THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions.');\n          }\n          if (levelCount > 1) {\n            mipWidth = levelInfo.origWidth;\n            mipHeight = levelInfo.origHeight;\n          } else {\n            // Handles non-multiple-of-four dimensions in textures without mipmaps. Textures with\n            // mipmaps must use multiple-of-four dimensions, for some texture formats and APIs.\n            // See mrdoob/three.js#25908.\n            mipWidth = levelInfo.width;\n            mipHeight = levelInfo.height;\n          }\n          let dst = new Uint8Array(ktx2File.getImageTranscodedSizeInBytes(mip, layer, 0, transcoderFormat));\n          const status = ktx2File.transcodeImage(dst, mip, layer, face, transcoderFormat, 0, -1, -1);\n          if (engineType === EngineType.HalfFloatType) {\n            dst = new Uint16Array(dst.buffer, dst.byteOffset, dst.byteLength / Uint16Array.BYTES_PER_ELEMENT);\n          }\n          if (!status) {\n            cleanup();\n            throw new Error('THREE.KTX2Loader: .transcodeImage failed.');\n          }\n          layerMips.push(dst);\n        }\n        const mipData = concat(layerMips);\n        mipmaps.push({\n          data: mipData,\n          width: mipWidth,\n          height: mipHeight\n        });\n        buffers.push(mipData.buffer);\n      }\n      faces.push({\n        mipmaps,\n        width,\n        height,\n        format: engineFormat,\n        type: engineType\n      });\n    }\n    cleanup();\n    return {\n      faces,\n      buffers,\n      width,\n      height,\n      hasAlpha,\n      dfdFlags,\n      format: engineFormat,\n      type: engineType\n    };\n  }\n\n  //\n\n  // Optimal choice of a transcoder target format depends on the Basis format (ETC1S, UASTC, or\n  // UASTC HDR), device capabilities, and texture dimensions. The list below ranks the formats\n  // separately for each format. Currently, priority is assigned based on:\n  //\n  //   high quality > low quality > uncompressed\n  //\n  // Prioritization may be revisited, or exposed for configuration, in the future.\n  //\n  // Reference: https://github.com/KhronosGroup/3D-Formats-Guidelines/blob/main/KTXDeveloperGuide.md\n  const FORMAT_OPTIONS = [{\n    if: 'astcSupported',\n    basisFormat: [BasisFormat.UASTC],\n    transcoderFormat: [TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4],\n    engineFormat: [EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format],\n    engineType: [EngineType.UnsignedByteType],\n    priorityETC1S: Infinity,\n    priorityUASTC: 1,\n    needsPowerOfTwo: false\n  }, {\n    if: 'bptcSupported',\n    basisFormat: [BasisFormat.ETC1S, BasisFormat.UASTC],\n    transcoderFormat: [TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5],\n    engineFormat: [EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format],\n    engineType: [EngineType.UnsignedByteType],\n    priorityETC1S: 3,\n    priorityUASTC: 2,\n    needsPowerOfTwo: false\n  }, {\n    if: 'dxtSupported',\n    basisFormat: [BasisFormat.ETC1S, BasisFormat.UASTC],\n    transcoderFormat: [TranscoderFormat.BC1, TranscoderFormat.BC3],\n    engineFormat: [EngineFormat.RGBA_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format],\n    engineType: [EngineType.UnsignedByteType],\n    priorityETC1S: 4,\n    priorityUASTC: 5,\n    needsPowerOfTwo: false\n  }, {\n    if: 'etc2Supported',\n    basisFormat: [BasisFormat.ETC1S, BasisFormat.UASTC],\n    transcoderFormat: [TranscoderFormat.ETC1, TranscoderFormat.ETC2],\n    engineFormat: [EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format],\n    engineType: [EngineType.UnsignedByteType],\n    priorityETC1S: 1,\n    priorityUASTC: 3,\n    needsPowerOfTwo: false\n  }, {\n    if: 'etc1Supported',\n    basisFormat: [BasisFormat.ETC1S, BasisFormat.UASTC],\n    transcoderFormat: [TranscoderFormat.ETC1],\n    engineFormat: [EngineFormat.RGB_ETC1_Format],\n    engineType: [EngineType.UnsignedByteType],\n    priorityETC1S: 2,\n    priorityUASTC: 4,\n    needsPowerOfTwo: false\n  }, {\n    if: 'pvrtcSupported',\n    basisFormat: [BasisFormat.ETC1S, BasisFormat.UASTC],\n    transcoderFormat: [TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA],\n    engineFormat: [EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format],\n    engineType: [EngineType.UnsignedByteType],\n    priorityETC1S: 5,\n    priorityUASTC: 6,\n    needsPowerOfTwo: true\n  }, {\n    if: 'bptcSupported',\n    basisFormat: [BasisFormat.UASTC_HDR],\n    transcoderFormat: [TranscoderFormat.BC6H],\n    engineFormat: [EngineFormat.RGB_BPTC_UNSIGNED_Format],\n    engineType: [EngineType.HalfFloatType],\n    priorityHDR: 1,\n    needsPowerOfTwo: false\n  },\n  // Uncompressed fallbacks.\n\n  {\n    basisFormat: [BasisFormat.ETC1S, BasisFormat.UASTC],\n    transcoderFormat: [TranscoderFormat.RGBA32, TranscoderFormat.RGBA32],\n    engineFormat: [EngineFormat.RGBAFormat, EngineFormat.RGBAFormat],\n    engineType: [EngineType.UnsignedByteType, EngineType.UnsignedByteType],\n    priorityETC1S: 100,\n    priorityUASTC: 100,\n    needsPowerOfTwo: false\n  }, {\n    basisFormat: [BasisFormat.UASTC_HDR],\n    transcoderFormat: [TranscoderFormat.RGBA_HALF],\n    engineFormat: [EngineFormat.RGBAFormat],\n    engineType: [EngineType.HalfFloatType],\n    priorityHDR: 100,\n    needsPowerOfTwo: false\n  }];\n  const OPTIONS = {\n    [BasisFormat.ETC1S]: FORMAT_OPTIONS.filter(opt => opt.basisFormat.includes(BasisFormat.ETC1S)).sort((a, b) => a.priorityETC1S - b.priorityETC1S),\n    [BasisFormat.UASTC]: FORMAT_OPTIONS.filter(opt => opt.basisFormat.includes(BasisFormat.UASTC)).sort((a, b) => a.priorityUASTC - b.priorityUASTC),\n    [BasisFormat.UASTC_HDR]: FORMAT_OPTIONS.filter(opt => opt.basisFormat.includes(BasisFormat.UASTC_HDR)).sort((a, b) => a.priorityHDR - b.priorityHDR)\n  };\n  function getTranscoderFormat(basisFormat, width, height, hasAlpha) {\n    const options = OPTIONS[basisFormat];\n    for (let i = 0; i < options.length; i++) {\n      const opt = options[i];\n      if (opt.if && !config[opt.if]) continue;\n      if (!opt.basisFormat.includes(basisFormat)) continue;\n      if (hasAlpha && opt.transcoderFormat.length < 2) continue;\n      if (opt.needsPowerOfTwo && !(isPowerOfTwo(width) && isPowerOfTwo(height))) continue;\n      const transcoderFormat = opt.transcoderFormat[hasAlpha ? 1 : 0];\n      const engineFormat = opt.engineFormat[hasAlpha ? 1 : 0];\n      const engineType = opt.engineType[0];\n      return {\n        transcoderFormat,\n        engineFormat,\n        engineType\n      };\n    }\n    throw new Error('THREE.KTX2Loader: Failed to identify transcoding target.');\n  }\n  function isPowerOfTwo(value) {\n    if (value <= 2) return true;\n    return (value & value - 1) === 0 && value !== 0;\n  }\n\n  /**\n   * Concatenates N byte arrays.\n   *\n   * @param {Uint8Array[]} arrays\n   * @return {Uint8Array}\n   */\n  function concat(arrays) {\n    if (arrays.length === 1) return arrays[0];\n    let totalByteLength = 0;\n    for (let i = 0; i < arrays.length; i++) {\n      const array = arrays[i];\n      totalByteLength += array.byteLength;\n    }\n    const result = new Uint8Array(totalByteLength);\n    let byteOffset = 0;\n    for (let i = 0; i < arrays.length; i++) {\n      const array = arrays[i];\n      result.set(array, byteOffset);\n      byteOffset += array.byteLength;\n    }\n    return result;\n  }\n};\n\n// Parsing for non-Basis textures. These textures may have supercompression\n// like Zstd, but they do not require transcoding.\n\nconst UNCOMPRESSED_FORMATS = new Set([RGBAFormat, RGBFormat, RGFormat, RedFormat]);\nconst FORMAT_MAP = {\n  [VK_FORMAT_R32G32B32A32_SFLOAT]: RGBAFormat,\n  [VK_FORMAT_R32G32_SFLOAT]: RGFormat,\n  [VK_FORMAT_R32_SFLOAT]: RedFormat,\n  [VK_FORMAT_R16G16B16A16_SFLOAT]: RGBAFormat,\n  [VK_FORMAT_R16G16_SFLOAT]: RGFormat,\n  [VK_FORMAT_R16_SFLOAT]: RedFormat,\n  [VK_FORMAT_R8G8B8A8_SRGB]: RGBAFormat,\n  [VK_FORMAT_R8G8B8A8_UNORM]: RGBAFormat,\n  [VK_FORMAT_R8G8_SRGB]: RGFormat,\n  [VK_FORMAT_R8G8_UNORM]: RGFormat,\n  [VK_FORMAT_R8_SRGB]: RedFormat,\n  [VK_FORMAT_R8_UNORM]: RedFormat,\n  [VK_FORMAT_E5B9G9R9_UFLOAT_PACK32]: RGBFormat,\n  [VK_FORMAT_B10G11R11_UFLOAT_PACK32]: RGBFormat,\n  [VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK]: RGBA_ETC2_EAC_Format,\n  [VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK]: RGB_ETC2_Format,\n  [VK_FORMAT_EAC_R11_UNORM_BLOCK]: R11_EAC_Format,\n  [VK_FORMAT_EAC_R11_SNORM_BLOCK]: SIGNED_R11_EAC_Format,\n  [VK_FORMAT_EAC_R11G11_UNORM_BLOCK]: RG11_EAC_Format,\n  [VK_FORMAT_EAC_R11G11_SNORM_BLOCK]: SIGNED_RG11_EAC_Format,\n  [VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT]: RGBA_ASTC_4x4_Format,\n  [VK_FORMAT_ASTC_4x4_SRGB_BLOCK]: RGBA_ASTC_4x4_Format,\n  [VK_FORMAT_ASTC_4x4_UNORM_BLOCK]: RGBA_ASTC_4x4_Format,\n  [VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT]: RGBA_ASTC_6x6_Format,\n  [VK_FORMAT_ASTC_6x6_SRGB_BLOCK]: RGBA_ASTC_6x6_Format,\n  [VK_FORMAT_ASTC_6x6_UNORM_BLOCK]: RGBA_ASTC_6x6_Format,\n  [VK_FORMAT_BC1_RGBA_SRGB_BLOCK]: RGBA_S3TC_DXT1_Format,\n  [VK_FORMAT_BC1_RGBA_UNORM_BLOCK]: RGBA_S3TC_DXT1_Format,\n  [VK_FORMAT_BC1_RGB_SRGB_BLOCK]: RGB_S3TC_DXT1_Format,\n  [VK_FORMAT_BC1_RGB_UNORM_BLOCK]: RGB_S3TC_DXT1_Format,\n  [VK_FORMAT_BC3_SRGB_BLOCK]: RGBA_S3TC_DXT3_Format,\n  [VK_FORMAT_BC3_UNORM_BLOCK]: RGBA_S3TC_DXT3_Format,\n  [VK_FORMAT_BC4_SNORM_BLOCK]: SIGNED_RED_RGTC1_Format,\n  [VK_FORMAT_BC4_UNORM_BLOCK]: RED_RGTC1_Format,\n  [VK_FORMAT_BC5_SNORM_BLOCK]: SIGNED_RED_GREEN_RGTC2_Format,\n  [VK_FORMAT_BC5_UNORM_BLOCK]: RED_GREEN_RGTC2_Format,\n  [VK_FORMAT_BC7_SRGB_BLOCK]: RGBA_BPTC_Format,\n  [VK_FORMAT_BC7_UNORM_BLOCK]: RGBA_BPTC_Format,\n  [VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG]: RGBA_PVRTC_4BPPV1_Format,\n  [VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG]: RGBA_PVRTC_4BPPV1_Format,\n  [VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG]: RGBA_PVRTC_2BPPV1_Format,\n  [VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG]: RGBA_PVRTC_2BPPV1_Format\n};\nconst TYPE_MAP = {\n  [VK_FORMAT_R32G32B32A32_SFLOAT]: FloatType,\n  [VK_FORMAT_R32G32_SFLOAT]: FloatType,\n  [VK_FORMAT_R32_SFLOAT]: FloatType,\n  [VK_FORMAT_R16G16B16A16_SFLOAT]: HalfFloatType,\n  [VK_FORMAT_R16G16_SFLOAT]: HalfFloatType,\n  [VK_FORMAT_R16_SFLOAT]: HalfFloatType,\n  [VK_FORMAT_R8G8B8A8_SRGB]: UnsignedByteType,\n  [VK_FORMAT_R8G8B8A8_UNORM]: UnsignedByteType,\n  [VK_FORMAT_R8G8_SRGB]: UnsignedByteType,\n  [VK_FORMAT_R8G8_UNORM]: UnsignedByteType,\n  [VK_FORMAT_R8_SRGB]: UnsignedByteType,\n  [VK_FORMAT_R8_UNORM]: UnsignedByteType,\n  [VK_FORMAT_E5B9G9R9_UFLOAT_PACK32]: UnsignedInt5999Type,\n  [VK_FORMAT_B10G11R11_UFLOAT_PACK32]: UnsignedInt101111Type,\n  [VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_EAC_R11_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_EAC_R11_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_EAC_R11G11_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_EAC_R11G11_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT]: HalfFloatType,\n  [VK_FORMAT_ASTC_4x4_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_ASTC_4x4_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT]: HalfFloatType,\n  [VK_FORMAT_ASTC_6x6_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_ASTC_6x6_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC1_RGBA_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC1_RGBA_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC1_RGB_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC1_RGB_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC3_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC3_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC4_SNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC4_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC5_SNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC5_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC7_SRGB_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_BC7_UNORM_BLOCK]: UnsignedByteType,\n  [VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG]: UnsignedByteType,\n  [VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG]: UnsignedByteType,\n  [VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG]: UnsignedByteType,\n  [VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG]: UnsignedByteType\n};\nasync function createRawTexture(container) {\n  const {\n    vkFormat\n  } = container;\n  if (FORMAT_MAP[vkFormat] === undefined) {\n    throw new Error('THREE.KTX2Loader: Unsupported vkFormat: ' + vkFormat);\n  }\n\n  // TODO: Merge the TYPE_MAP warning into the thrown error above, after r190.\n  if (TYPE_MAP[vkFormat] === undefined) {\n    console.warn('THREE.KTX2Loader: Missing \".type\" for vkFormat: ' + vkFormat);\n  }\n\n  //\n\n  let zstd;\n  if (container.supercompressionScheme === KHR_SUPERCOMPRESSION_ZSTD) {\n    if (!_zstd) {\n      _zstd = new Promise(async resolve => {\n        const zstd = new ZSTDDecoder();\n        await zstd.init();\n        resolve(zstd);\n      });\n    }\n    zstd = await _zstd;\n  }\n\n  //\n\n  const mipmaps = [];\n  for (let levelIndex = 0; levelIndex < container.levels.length; levelIndex++) {\n    const levelWidth = Math.max(1, container.pixelWidth >> levelIndex);\n    const levelHeight = Math.max(1, container.pixelHeight >> levelIndex);\n    const levelDepth = container.pixelDepth ? Math.max(1, container.pixelDepth >> levelIndex) : 0;\n    const level = container.levels[levelIndex];\n    let levelData;\n    if (container.supercompressionScheme === KHR_SUPERCOMPRESSION_NONE) {\n      levelData = level.levelData;\n    } else if (container.supercompressionScheme === KHR_SUPERCOMPRESSION_ZSTD) {\n      levelData = zstd.decode(level.levelData, level.uncompressedByteLength);\n    } else {\n      throw new Error('THREE.KTX2Loader: Unsupported supercompressionScheme.');\n    }\n    let data;\n    if (TYPE_MAP[vkFormat] === FloatType) {\n      data = new Float32Array(levelData.buffer, levelData.byteOffset, levelData.byteLength / Float32Array.BYTES_PER_ELEMENT);\n    } else if (TYPE_MAP[vkFormat] === HalfFloatType) {\n      data = new Uint16Array(levelData.buffer, levelData.byteOffset, levelData.byteLength / Uint16Array.BYTES_PER_ELEMENT);\n    } else if (TYPE_MAP[vkFormat] === UnsignedInt5999Type || TYPE_MAP[vkFormat] === UnsignedInt101111Type) {\n      data = new Uint32Array(levelData.buffer, levelData.byteOffset, levelData.byteLength / Uint32Array.BYTES_PER_ELEMENT);\n    } else {\n      data = levelData;\n    }\n    mipmaps.push({\n      data: data,\n      width: levelWidth,\n      height: levelHeight,\n      depth: levelDepth\n    });\n  }\n\n  // levelCount = 0 implies runtime-generated mipmaps.\n  const useMipmaps = container.levelCount === 0 || mipmaps.length > 1;\n  let texture;\n  if (UNCOMPRESSED_FORMATS.has(FORMAT_MAP[vkFormat])) {\n    texture = container.pixelDepth === 0 ? new DataTexture(mipmaps[0].data, container.pixelWidth, container.pixelHeight) : new Data3DTexture(mipmaps[0].data, container.pixelWidth, container.pixelHeight, container.pixelDepth);\n    texture.minFilter = useMipmaps ? NearestMipmapNearestFilter : NearestFilter;\n    texture.magFilter = NearestFilter;\n    texture.generateMipmaps = container.levelCount === 0;\n  } else {\n    if (container.pixelDepth > 0) throw new Error('THREE.KTX2Loader: Unsupported pixelDepth.');\n    texture = new CompressedTexture(mipmaps, container.pixelWidth, container.pixelHeight);\n    texture.minFilter = useMipmaps ? LinearMipmapLinearFilter : LinearFilter;\n    texture.magFilter = LinearFilter;\n  }\n  texture.mipmaps = mipmaps;\n  texture.type = TYPE_MAP[vkFormat];\n  texture.format = FORMAT_MAP[vkFormat];\n  texture.colorSpace = parseColorSpace(container);\n  texture.needsUpdate = true;\n\n  //\n\n  return Promise.resolve(texture);\n}\nfunction parseColorSpace(container) {\n  const dfd = container.dataFormatDescriptor[0];\n  if (dfd.colorPrimaries === KHR_DF_PRIMARIES_BT709) {\n    return dfd.transferFunction === KHR_DF_TRANSFER_SRGB ? SRGBColorSpace : LinearSRGBColorSpace;\n  } else if (dfd.colorPrimaries === KHR_DF_PRIMARIES_DISPLAYP3) {\n    return dfd.transferFunction === KHR_DF_TRANSFER_SRGB ? DisplayP3ColorSpace : LinearDisplayP3ColorSpace;\n  } else if (dfd.colorPrimaries === KHR_DF_PRIMARIES_UNSPECIFIED) {\n    return NoColorSpace;\n  } else {\n    console.warn(`THREE.KTX2Loader: Unsupported color primaries, \"${dfd.colorPrimaries}\"`);\n    return NoColorSpace;\n  }\n}\nexport { KTX2Loader };","map":{"version":3,"names":["CompressedArrayTexture","CompressedCubeTexture","CompressedTexture","Data3DTexture","DataTexture","FileLoader","FloatType","HalfFloatType","LinearFilter","LinearMipmapLinearFilter","NearestFilter","NearestMipmapNearestFilter","LinearSRGBColorSpace","Loader","NoColorSpace","RGBAFormat","RGBA_ASTC_4x4_Format","RGBA_ASTC_6x6_Format","RGBA_BPTC_Format","RGBA_S3TC_DXT3_Format","RGBA_ETC2_EAC_Format","R11_EAC_Format","SIGNED_R11_EAC_Format","RG11_EAC_Format","SIGNED_RG11_EAC_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_PVRTC_2BPPV1_Format","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT5_Format","RGB_BPTC_UNSIGNED_Format","RGB_ETC1_Format","RGB_ETC2_Format","RGB_PVRTC_4BPPV1_Format","RGB_S3TC_DXT1_Format","SIGNED_RED_GREEN_RGTC2_Format","SIGNED_RED_RGTC1_Format","RED_GREEN_RGTC2_Format","RED_RGTC1_Format","RGBFormat","RGFormat","RedFormat","SRGBColorSpace","UnsignedByteType","UnsignedInt5999Type","UnsignedInt101111Type","WorkerPool","read","KHR_DF_FLAG_ALPHA_PREMULTIPLIED","KHR_DF_PRIMARIES_BT709","KHR_DF_PRIMARIES_DISPLAYP3","KHR_DF_PRIMARIES_UNSPECIFIED","KHR_DF_TRANSFER_SRGB","KHR_SUPERCOMPRESSION_NONE","KHR_SUPERCOMPRESSION_ZSTD","VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT","VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT","VK_FORMAT_ASTC_4x4_SRGB_BLOCK","VK_FORMAT_ASTC_4x4_UNORM_BLOCK","VK_FORMAT_ASTC_6x6_SRGB_BLOCK","VK_FORMAT_ASTC_6x6_UNORM_BLOCK","VK_FORMAT_BC1_RGBA_SRGB_BLOCK","VK_FORMAT_BC1_RGBA_UNORM_BLOCK","VK_FORMAT_BC1_RGB_SRGB_BLOCK","VK_FORMAT_BC1_RGB_UNORM_BLOCK","VK_FORMAT_BC3_SRGB_BLOCK","VK_FORMAT_BC3_UNORM_BLOCK","VK_FORMAT_BC4_SNORM_BLOCK","VK_FORMAT_BC4_UNORM_BLOCK","VK_FORMAT_BC5_SNORM_BLOCK","VK_FORMAT_BC5_UNORM_BLOCK","VK_FORMAT_BC7_SRGB_BLOCK","VK_FORMAT_BC7_UNORM_BLOCK","VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK","VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK","VK_FORMAT_EAC_R11_UNORM_BLOCK","VK_FORMAT_EAC_R11_SNORM_BLOCK","VK_FORMAT_EAC_R11G11_UNORM_BLOCK","VK_FORMAT_EAC_R11G11_SNORM_BLOCK","VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG","VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG","VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG","VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG","VK_FORMAT_R16G16B16A16_SFLOAT","VK_FORMAT_R16G16_SFLOAT","VK_FORMAT_R16_SFLOAT","VK_FORMAT_R32G32B32A32_SFLOAT","VK_FORMAT_R32G32_SFLOAT","VK_FORMAT_R32_SFLOAT","VK_FORMAT_R8G8B8A8_SRGB","VK_FORMAT_R8G8B8A8_UNORM","VK_FORMAT_R8G8_SRGB","VK_FORMAT_R8G8_UNORM","VK_FORMAT_R8_SRGB","VK_FORMAT_R8_UNORM","VK_FORMAT_E5B9G9R9_UFLOAT_PACK32","VK_FORMAT_B10G11R11_UFLOAT_PACK32","VK_FORMAT_UNDEFINED","ZSTDDecoder","DisplayP3ColorSpace","LinearDisplayP3ColorSpace","_taskCache","WeakMap","_activeLoaders","_zstd","KTX2Loader","constructor","manager","transcoderPath","transcoderBinary","transcoderPending","workerPool","workerSourceURL","workerConfig","MSC_TRANSCODER","console","warn","setTranscoderPath","path","setWorkerLimit","workerLimit","detectSupportAsync","renderer","init","detectSupport","isWebGPURenderer","astcSupported","hasFeature","astcHDRSupported","etc1Supported","etc2Supported","dxtSupported","bptcSupported","pvrtcSupported","extensions","has","get","getSupportedProfiles","includes","navigator","platform","indexOf","userAgent","jsLoader","setPath","setWithCredentials","withCredentials","jsContent","loadAsync","binaryLoader","setResponseType","binaryContent","Promise","all","then","fn","BasisWorker","toString","body","JSON","stringify","EngineFormat","EngineType","TranscoderFormat","BasisFormat","substring","lastIndexOf","join","URL","createObjectURL","Blob","setWorkerCreator","worker","Worker","slice","postMessage","type","config","load","url","onLoad","onProgress","onError","Error","loader","setCrossOrigin","crossOrigin","setRequestHeader","requestHeader","buffer","parse","cachedTask","promise","catch","_createTexture","texture","_createTextureFrom","transcodeResult","container","messageType","error","data","faces","width","height","format","dfdFlags","reject","faceCount","mipmaps","layerCount","minFilter","length","magFilter","generateMipmaps","needsUpdate","colorSpace","parseColorSpace","premultiplyAlpha","Uint8Array","isBasisHDR","vkFormat","dataFormatDescriptor","colorModel","needsTranscoder","createRawTexture","taskConfig","texturePending","e","set","dispose","revokeObjectURL","ETC1S","UASTC","UASTC_HDR","ETC1","ETC2","BC1","BC3","BC4","BC5","BC7_M6_OPAQUE_ONLY","BC7_M5","PVRTC1_4_RGB","PVRTC1_4_RGBA","ASTC_4x4","ATC_RGB","ATC_RGBA_INTERPOLATED_ALPHA","RGBA32","RGB565","BGR565","RGBA4444","BC6H","RGB_HALF","RGBA_HALF","BasisModule","_EngineFormat","_EngineType","_TranscoderFormat","_BasisFormat","self","addEventListener","message","buffers","hasAlpha","transcode","id","wasmBinary","resolve","onRuntimeInitialized","BASIS","initializeBasis","KTX2File","undefined","ktx2File","cleanup","close","delete","isValid","basisFormat","isUASTC","isETC1S","isHDR","getWidth","getHeight","getLayers","levelCount","getLevels","getFaces","getHasAlpha","getDFDFlags","transcoderFormat","engineFormat","engineType","getTranscoderFormat","startTranscoding","face","mip","layerMips","mipWidth","mipHeight","layer","levelInfo","getImageLevelInfo","origWidth","origHeight","dst","getImageTranscodedSizeInBytes","status","transcodeImage","Uint16Array","byteOffset","byteLength","BYTES_PER_ELEMENT","push","mipData","concat","FORMAT_OPTIONS","if","priorityETC1S","Infinity","priorityUASTC","needsPowerOfTwo","priorityHDR","OPTIONS","filter","opt","sort","a","b","options","i","isPowerOfTwo","value","arrays","totalByteLength","array","result","UNCOMPRESSED_FORMATS","Set","FORMAT_MAP","TYPE_MAP","zstd","supercompressionScheme","levelIndex","levels","levelWidth","Math","max","pixelWidth","levelHeight","pixelHeight","levelDepth","pixelDepth","level","levelData","decode","uncompressedByteLength","Float32Array","Uint32Array","depth","useMipmaps","dfd","colorPrimaries","transferFunction"],"sources":["C:/Users/LENOVO/Music/OneDrive/Pictures/distribution-agency-project/frontend/node_modules/three/examples/jsm/loaders/KTX2Loader.js"],"sourcesContent":["import {\n\tCompressedArrayTexture,\n\tCompressedCubeTexture,\n\tCompressedTexture,\n\tData3DTexture,\n\tDataTexture,\n\tFileLoader,\n\tFloatType,\n\tHalfFloatType,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tNearestFilter,\n\tNearestMipmapNearestFilter,\n\tLinearSRGBColorSpace,\n\tLoader,\n\tNoColorSpace,\n\tRGBAFormat,\n\tRGBA_ASTC_4x4_Format,\n\tRGBA_ASTC_6x6_Format,\n\tRGBA_BPTC_Format,\n\tRGBA_S3TC_DXT3_Format,\n\tRGBA_ETC2_EAC_Format,\n\tR11_EAC_Format,\n\tSIGNED_R11_EAC_Format,\n\tRG11_EAC_Format,\n\tSIGNED_RG11_EAC_Format,\n\tRGBA_PVRTC_4BPPV1_Format,\n\tRGBA_PVRTC_2BPPV1_Format,\n\tRGBA_S3TC_DXT1_Format,\n\tRGBA_S3TC_DXT5_Format,\n\tRGB_BPTC_UNSIGNED_Format,\n\tRGB_ETC1_Format,\n\tRGB_ETC2_Format,\n\tRGB_PVRTC_4BPPV1_Format,\n\tRGB_S3TC_DXT1_Format,\n\tSIGNED_RED_GREEN_RGTC2_Format,\n\tSIGNED_RED_RGTC1_Format,\n\tRED_GREEN_RGTC2_Format,\n\tRED_RGTC1_Format,\n\tRGBFormat,\n\tRGFormat,\n\tRedFormat,\n\tSRGBColorSpace,\n\tUnsignedByteType,\n\tUnsignedInt5999Type,\n\tUnsignedInt101111Type\n} from 'three';\nimport { WorkerPool } from '../utils/WorkerPool.js';\nimport {\n\tread,\n\tKHR_DF_FLAG_ALPHA_PREMULTIPLIED,\n\tKHR_DF_PRIMARIES_BT709,\n\tKHR_DF_PRIMARIES_DISPLAYP3,\n\tKHR_DF_PRIMARIES_UNSPECIFIED,\n\tKHR_DF_TRANSFER_SRGB,\n\tKHR_SUPERCOMPRESSION_NONE,\n\tKHR_SUPERCOMPRESSION_ZSTD,\n\tVK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT,\n\tVK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT,\n\tVK_FORMAT_ASTC_4x4_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_4x4_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_6x6_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_6x6_UNORM_BLOCK,\n\tVK_FORMAT_BC1_RGBA_SRGB_BLOCK,\n\tVK_FORMAT_BC1_RGBA_UNORM_BLOCK,\n\tVK_FORMAT_BC1_RGB_SRGB_BLOCK,\n\tVK_FORMAT_BC1_RGB_UNORM_BLOCK,\n\tVK_FORMAT_BC3_SRGB_BLOCK,\n\tVK_FORMAT_BC3_UNORM_BLOCK,\n\tVK_FORMAT_BC4_SNORM_BLOCK,\n\tVK_FORMAT_BC4_UNORM_BLOCK,\n\tVK_FORMAT_BC5_SNORM_BLOCK,\n\tVK_FORMAT_BC5_UNORM_BLOCK,\n\tVK_FORMAT_BC7_SRGB_BLOCK,\n\tVK_FORMAT_BC7_UNORM_BLOCK,\n\tVK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK,\n\tVK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK,\n\tVK_FORMAT_EAC_R11_UNORM_BLOCK,\n\tVK_FORMAT_EAC_R11_SNORM_BLOCK,\n\tVK_FORMAT_EAC_R11G11_UNORM_BLOCK,\n\tVK_FORMAT_EAC_R11G11_SNORM_BLOCK,\n\tVK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG,\n\tVK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG,\n\tVK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG,\n\tVK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG,\n\tVK_FORMAT_R16G16B16A16_SFLOAT,\n\tVK_FORMAT_R16G16_SFLOAT,\n\tVK_FORMAT_R16_SFLOAT,\n\tVK_FORMAT_R32G32B32A32_SFLOAT,\n\tVK_FORMAT_R32G32_SFLOAT,\n\tVK_FORMAT_R32_SFLOAT,\n\tVK_FORMAT_R8G8B8A8_SRGB,\n\tVK_FORMAT_R8G8B8A8_UNORM,\n\tVK_FORMAT_R8G8_SRGB,\n\tVK_FORMAT_R8G8_UNORM,\n\tVK_FORMAT_R8_SRGB,\n\tVK_FORMAT_R8_UNORM,\n\tVK_FORMAT_E5B9G9R9_UFLOAT_PACK32,\n\tVK_FORMAT_B10G11R11_UFLOAT_PACK32,\n\tVK_FORMAT_UNDEFINED\n} from '../libs/ktx-parse.module.js';\nimport { ZSTDDecoder } from '../libs/zstddec.module.js';\nimport { DisplayP3ColorSpace, LinearDisplayP3ColorSpace } from '../math/ColorSpaces.js';\n\nconst _taskCache = new WeakMap();\n\nlet _activeLoaders = 0;\n\nlet _zstd;\n\n/**\n * A loader for KTX 2.0 GPU Texture containers.\n *\n * KTX 2.0 is a container format for various GPU texture formats. The loader supports Basis Universal GPU textures,\n * which can be quickly transcoded to a wide variety of GPU texture compression formats. While KTX 2.0 also allows\n * other hardware-specific formats, this loader does not yet parse them.\n *\n * This loader parses the KTX 2.0 container and transcodes to a supported GPU compressed texture format.\n * The required WASM transcoder and JS wrapper are available from the `examples/jsm/libs/basis` directory.\n *\n * This loader relies on Web Assembly which is not supported in older browsers.\n *\n * References:\n * - [KTX specification](http://github.khronos.org/KTX-Specification/)\n * - [DFD](https://www.khronos.org/registry/DataFormat/specs/1.3/dataformat.1.3.html#basicdescriptor)\n * - [BasisU HDR](https://github.com/BinomialLLC/basis_universal/wiki/UASTC-HDR-Texture-Specification-v1.0)\n *\n * ```js\n * const loader = new KTX2Loader();\n * loader.setTranscoderPath( 'examples/jsm/libs/basis/' );\n * loader.detectSupport( renderer );\n * const texture = loader.loadAsync( 'diffuse.ktx2' );\n * ```\n *\n * @augments Loader\n * @three_import import { KTX2Loader } from 'three/addons/loaders/KTX2Loader.js';\n */\nclass KTX2Loader extends Loader {\n\n\t/**\n\t * Constructs a new KTX2 loader.\n\t *\n\t * @param {LoadingManager} [manager] - The loading manager.\n\t */\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.transcoderPath = '';\n\t\tthis.transcoderBinary = null;\n\t\tthis.transcoderPending = null;\n\n\t\tthis.workerPool = new WorkerPool();\n\t\tthis.workerSourceURL = '';\n\t\tthis.workerConfig = null;\n\n\t\tif ( typeof MSC_TRANSCODER !== 'undefined' ) {\n\n\t\t\tconsole.warn(\n\n\t\t\t\t'THREE.KTX2Loader: Please update to latest \"basis_transcoder\".'\n\t\t\t\t+ ' \"msc_basis_transcoder\" is no longer supported in three.js r125+.'\n\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Sets the transcoder path.\n\t *\n\t * The WASM transcoder and JS wrapper are available from the `examples/jsm/libs/basis` directory.\n\t *\n\t * @param {string} path - The transcoder path to set.\n\t * @return {KTX2Loader} A reference to this loader.\n\t */\n\tsetTranscoderPath( path ) {\n\n\t\tthis.transcoderPath = path;\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Sets the maximum number of Web Workers to be allocated by this instance.\n\t *\n\t * @param {number} workerLimit - The worker limit.\n\t * @return {KTX2Loader} A reference to this loader.\n\t */\n\tsetWorkerLimit( workerLimit ) {\n\n\t\tthis.workerPool.setWorkerLimit( workerLimit );\n\n\t\treturn this;\n\n\t}\n\n\n\t/**\n\t * Async version of {@link KTX2Loader#detectSupport}.\n\t *\n\t * @async\n\t * @deprecated\n\t * @param {WebGPURenderer} renderer - The renderer.\n\t * @return {Promise} A Promise that resolves when the support has been detected.\n\t */\n\tasync detectSupportAsync( renderer ) {\n\n\t\tconsole.warn( 'KTX2Loader: \"detectSupportAsync()\" has been deprecated. Use \"detectSupport()\" and \"await renderer.init();\" when creating the renderer.' ); // @deprecated r181\n\n\t\tawait renderer.init();\n\n\t\treturn this.detectSupport( renderer );\n\n\t}\n\n\t/**\n\t * Detects hardware support for available compressed texture formats, to determine\n\t * the output format for the transcoder. Must be called before loading a texture.\n\t *\n\t * @param {WebGPURenderer|WebGLRenderer} renderer - The renderer.\n\t * @return {KTX2Loader} A reference to this loader.\n\t */\n\tdetectSupport( renderer ) {\n\n\t\tif ( renderer.isWebGPURenderer === true ) {\n\n\t\t\tthis.workerConfig = {\n\t\t\t\tastcSupported: renderer.hasFeature( 'texture-compression-astc' ),\n\t\t\t\tastcHDRSupported: false, // https://github.com/gpuweb/gpuweb/issues/3856\n\t\t\t\tetc1Supported: renderer.hasFeature( 'texture-compression-etc1' ),\n\t\t\t\tetc2Supported: renderer.hasFeature( 'texture-compression-etc2' ),\n\t\t\t\tdxtSupported: renderer.hasFeature( 'texture-compression-s3tc' ),\n\t\t\t\tbptcSupported: renderer.hasFeature( 'texture-compression-bc' ),\n\t\t\t\tpvrtcSupported: renderer.hasFeature( 'texture-compression-pvrtc' )\n\t\t\t};\n\n\t\t} else {\n\n\t\t\tthis.workerConfig = {\n\t\t\t\tastcSupported: renderer.extensions.has( 'WEBGL_compressed_texture_astc' ),\n\t\t\t\tastcHDRSupported: renderer.extensions.has( 'WEBGL_compressed_texture_astc' )\n\t\t\t\t\t&& renderer.extensions.get( 'WEBGL_compressed_texture_astc' ).getSupportedProfiles().includes( 'hdr' ),\n\t\t\t\tetc1Supported: renderer.extensions.has( 'WEBGL_compressed_texture_etc1' ),\n\t\t\t\tetc2Supported: renderer.extensions.has( 'WEBGL_compressed_texture_etc' ),\n\t\t\t\tdxtSupported: renderer.extensions.has( 'WEBGL_compressed_texture_s3tc' ),\n\t\t\t\tbptcSupported: renderer.extensions.has( 'EXT_texture_compression_bptc' ),\n\t\t\t\tpvrtcSupported: renderer.extensions.has( 'WEBGL_compressed_texture_pvrtc' )\n\t\t\t\t\t|| renderer.extensions.has( 'WEBKIT_WEBGL_compressed_texture_pvrtc' )\n\t\t\t};\n\n\t\t\tif ( typeof navigator !== 'undefined' &&\n\t\t\t\tnavigator.platform.indexOf( 'Linux' ) >= 0 && navigator.userAgent.indexOf( 'Firefox' ) >= 0 &&\n\t\t\t\tthis.workerConfig.astcSupported && this.workerConfig.etc2Supported &&\n\t\t\t\tthis.workerConfig.bptcSupported && this.workerConfig.dxtSupported ) {\n\n\t\t\t\t// On Linux, Mesa drivers for AMD and Intel GPUs expose ETC2 and ASTC even though the hardware doesn't support these.\n\t\t\t\t// Using these extensions will result in expensive software decompression on the main thread inside the driver, causing performance issues.\n\t\t\t\t// When using ANGLE (e.g. via Chrome), these extensions are not exposed except for some specific Intel GPU models - however, Firefox doesn't perform this filtering.\n\t\t\t\t// Since a granular filter is a little too fragile and we can transcode into other GPU formats, disable formats that are likely to be emulated.\n\n\t\t\t\tthis.workerConfig.astcSupported = false;\n\t\t\t\tthis.workerConfig.etc2Supported = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t// TODO: Make this method private\n\n\tinit() {\n\n\t\tif ( ! this.transcoderPending ) {\n\n\t\t\t// Load transcoder wrapper.\n\t\t\tconst jsLoader = new FileLoader( this.manager );\n\t\t\tjsLoader.setPath( this.transcoderPath );\n\t\t\tjsLoader.setWithCredentials( this.withCredentials );\n\t\t\tconst jsContent = jsLoader.loadAsync( 'basis_transcoder.js' );\n\n\t\t\t// Load transcoder WASM binary.\n\t\t\tconst binaryLoader = new FileLoader( this.manager );\n\t\t\tbinaryLoader.setPath( this.transcoderPath );\n\t\t\tbinaryLoader.setResponseType( 'arraybuffer' );\n\t\t\tbinaryLoader.setWithCredentials( this.withCredentials );\n\t\t\tconst binaryContent = binaryLoader.loadAsync( 'basis_transcoder.wasm' );\n\n\t\t\tthis.transcoderPending = Promise.all( [ jsContent, binaryContent ] )\n\t\t\t\t.then( ( [ jsContent, binaryContent ] ) => {\n\n\t\t\t\t\tconst fn = KTX2Loader.BasisWorker.toString();\n\n\t\t\t\t\tconst body = [\n\t\t\t\t\t\t'/* constants */',\n\t\t\t\t\t\t'let _EngineFormat = ' + JSON.stringify( KTX2Loader.EngineFormat ),\n\t\t\t\t\t\t'let _EngineType = ' + JSON.stringify( KTX2Loader.EngineType ),\n\t\t\t\t\t\t'let _TranscoderFormat = ' + JSON.stringify( KTX2Loader.TranscoderFormat ),\n\t\t\t\t\t\t'let _BasisFormat = ' + JSON.stringify( KTX2Loader.BasisFormat ),\n\t\t\t\t\t\t'/* basis_transcoder.js */',\n\t\t\t\t\t\tjsContent,\n\t\t\t\t\t\t'/* worker */',\n\t\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\n\t\t\t\t\t].join( '\\n' );\n\n\t\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\n\t\t\t\t\tthis.transcoderBinary = binaryContent;\n\n\t\t\t\t\tthis.workerPool.setWorkerCreator( () => {\n\n\t\t\t\t\t\tconst worker = new Worker( this.workerSourceURL );\n\t\t\t\t\t\tconst transcoderBinary = this.transcoderBinary.slice( 0 );\n\n\t\t\t\t\t\tworker.postMessage( { type: 'init', config: this.workerConfig, transcoderBinary }, [ transcoderBinary ] );\n\n\t\t\t\t\t\treturn worker;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\tif ( _activeLoaders > 0 ) {\n\n\t\t\t\t// Each instance loads a transcoder and allocates workers, increasing network and memory cost.\n\n\t\t\t\tconsole.warn(\n\n\t\t\t\t\t'THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues.'\n\t\t\t\t\t+ ' Use a single KTX2Loader instance, or call .dispose() on old instances.'\n\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t\t_activeLoaders ++;\n\n\t\t}\n\n\t\treturn this.transcoderPending;\n\n\t}\n\n\t/**\n\t * Starts loading from the given URL and passes the loaded KTX2 texture\n\t * to the `onLoad()` callback.\n\t *\n\t * @param {string} url - The path/URL of the file to be loaded. This can also be a data URI.\n\t * @param {function(CompressedTexture)} onLoad - Executed when the loading process has been finished.\n\t * @param {onProgressCallback} onProgress - Executed while the loading is in progress.\n\t * @param {onErrorCallback} onError - Executed when errors occur.\n\t */\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tif ( this.workerConfig === null ) {\n\n\t\t\tthrow new Error( 'THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.' );\n\n\t\t}\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setCrossOrigin( this.crossOrigin );\n\t\tloader.setWithCredentials( this.withCredentials );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setResponseType( 'arraybuffer' );\n\n\t\tloader.load( url, ( buffer ) => {\n\n\t\t\tthis.parse( buffer, onLoad, onError );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Parses the given KTX2 data.\n\t *\n\t * @param {ArrayBuffer} buffer - The raw KTX2 data as an array buffer.\n\t * @param {function(CompressedTexture)} onLoad - Executed when the loading/parsing process has been finished.\n\t * @param {onErrorCallback} onError - Executed when errors occur.\n\t * @returns {Promise} A Promise that resolves when the parsing has been finished.\n\t */\n\tparse( buffer, onLoad, onError ) {\n\n\t\tif ( this.workerConfig === null ) {\n\n\t\t\tthrow new Error( 'THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.' );\n\n\t\t}\n\n\t\t// Check for an existing task using this buffer. A transferred buffer cannot be transferred\n\t\t// again from this thread.\n\t\tif ( _taskCache.has( buffer ) ) {\n\n\t\t\tconst cachedTask = _taskCache.get( buffer );\n\n\t\t\treturn cachedTask.promise.then( onLoad ).catch( onError );\n\n\t\t}\n\n\t\tthis._createTexture( buffer )\n\t\t\t.then( ( texture ) => onLoad ? onLoad( texture ) : null )\n\t\t\t.catch( onError );\n\n\t}\n\n\t_createTextureFrom( transcodeResult, container ) {\n\n\t\tconst { type: messageType, error, data: { faces, width, height, format, type, dfdFlags } } = transcodeResult;\n\n\t\tif ( messageType === 'error' ) return Promise.reject( error );\n\n\t\tlet texture;\n\n\t\tif ( container.faceCount === 6 ) {\n\n\t\t\ttexture = new CompressedCubeTexture( faces, format, type );\n\n\t\t} else {\n\n\t\t\tconst mipmaps = faces[ 0 ].mipmaps;\n\n\t\t\ttexture = container.layerCount > 1\n\t\t\t\t? new CompressedArrayTexture( mipmaps, width, height, container.layerCount, format, type )\n\t\t\t\t: new CompressedTexture( mipmaps, width, height, format, type );\n\n\t\t}\n\n\t\ttexture.minFilter = faces[ 0 ].mipmaps.length === 1 ? LinearFilter : LinearMipmapLinearFilter;\n\t\ttexture.magFilter = LinearFilter;\n\t\ttexture.generateMipmaps = false;\n\n\t\ttexture.needsUpdate = true;\n\t\ttexture.colorSpace = parseColorSpace( container );\n\t\ttexture.premultiplyAlpha = !! ( dfdFlags & KHR_DF_FLAG_ALPHA_PREMULTIPLIED );\n\n\t\treturn texture;\n\n\t}\n\n\t/**\n\t * @private\n\t * @param {ArrayBuffer} buffer\n\t * @param {?Object} config\n\t * @return {Promise<CompressedTexture|CompressedArrayTexture|DataTexture|Data3DTexture>}\n\t */\n\tasync _createTexture( buffer, config = {} ) {\n\n\t\tconst container = read( new Uint8Array( buffer ) );\n\n\t\t// Basis UASTC HDR is a subset of ASTC, which can be transcoded efficiently\n\t\t// to BC6H. To detect whether a KTX2 file uses Basis UASTC HDR, or default\n\t\t// ASTC, inspect the DFD color model.\n\t\t//\n\t\t// Source: https://github.com/BinomialLLC/basis_universal/issues/381\n\t\tconst isBasisHDR = container.vkFormat === VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT\n\t\t\t&& container.dataFormatDescriptor[ 0 ].colorModel === 0xA7;\n\n\t\t// If the device supports ASTC, Basis UASTC HDR requires no transcoder.\n\t\tconst needsTranscoder = container.vkFormat === VK_FORMAT_UNDEFINED\n\t\t\t|| isBasisHDR && ! this.workerConfig.astcHDRSupported;\n\n\t\tif ( ! needsTranscoder ) {\n\n\t\t\treturn createRawTexture( container );\n\n\t\t}\n\n\t\t//\n\t\tconst taskConfig = config;\n\t\tconst texturePending = this.init().then( () => {\n\n\t\t\treturn this.workerPool.postMessage( { type: 'transcode', buffer, taskConfig: taskConfig }, [ buffer ] );\n\n\t\t} ).then( ( e ) => this._createTextureFrom( e.data, container ) );\n\n\t\t// Cache the task result.\n\t\t_taskCache.set( buffer, { promise: texturePending } );\n\n\t\treturn texturePending;\n\n\t}\n\n\t/**\n\t * Frees internal resources. This method should be called\n\t * when the loader is no longer required.\n\t */\n\tdispose() {\n\n\t\tthis.workerPool.dispose();\n\t\tif ( this.workerSourceURL ) URL.revokeObjectURL( this.workerSourceURL );\n\n\t\t_activeLoaders --;\n\n\t}\n\n}\n\n\n/* CONSTANTS */\n\nKTX2Loader.BasisFormat = {\n\tETC1S: 0,\n\tUASTC: 1,\n\tUASTC_HDR: 2,\n};\n\n// Source: https://github.com/BinomialLLC/basis_universal/blob/master/webgl/texture_test/index.html\nKTX2Loader.TranscoderFormat = {\n\tETC1: 0,\n\tETC2: 1,\n\tBC1: 2,\n\tBC3: 3,\n\tBC4: 4,\n\tBC5: 5,\n\tBC7_M6_OPAQUE_ONLY: 6,\n\tBC7_M5: 7,\n\tPVRTC1_4_RGB: 8,\n\tPVRTC1_4_RGBA: 9,\n\tASTC_4x4: 10,\n\tATC_RGB: 11,\n\tATC_RGBA_INTERPOLATED_ALPHA: 12,\n\tRGBA32: 13,\n\tRGB565: 14,\n\tBGR565: 15,\n\tRGBA4444: 16,\n\tBC6H: 22,\n\tRGB_HALF: 24,\n\tRGBA_HALF: 25,\n};\n\nKTX2Loader.EngineFormat = {\n\tRGBAFormat: RGBAFormat,\n\tRGBA_ASTC_4x4_Format: RGBA_ASTC_4x4_Format,\n\tRGB_BPTC_UNSIGNED_Format: RGB_BPTC_UNSIGNED_Format,\n\tRGBA_BPTC_Format: RGBA_BPTC_Format,\n\tRGBA_ETC2_EAC_Format: RGBA_ETC2_EAC_Format,\n\tRGBA_PVRTC_4BPPV1_Format: RGBA_PVRTC_4BPPV1_Format,\n\tRGBA_S3TC_DXT5_Format: RGBA_S3TC_DXT5_Format,\n\tRGB_ETC1_Format: RGB_ETC1_Format,\n\tRGB_ETC2_Format: RGB_ETC2_Format,\n\tRGB_PVRTC_4BPPV1_Format: RGB_PVRTC_4BPPV1_Format,\n\tRGBA_S3TC_DXT1_Format: RGBA_S3TC_DXT1_Format,\n};\n\nKTX2Loader.EngineType = {\n\tUnsignedByteType: UnsignedByteType,\n\tHalfFloatType: HalfFloatType,\n\tFloatType: FloatType,\n};\n\n/* WEB WORKER */\n\nKTX2Loader.BasisWorker = function () {\n\n\tlet config;\n\tlet transcoderPending;\n\tlet BasisModule;\n\n\tconst EngineFormat = _EngineFormat; // eslint-disable-line no-undef\n\tconst EngineType = _EngineType; // eslint-disable-line no-undef\n\tconst TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef\n\tconst BasisFormat = _BasisFormat; // eslint-disable-line no-undef\n\n\tself.addEventListener( 'message', function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tconfig = message.config;\n\t\t\t\tinit( message.transcoderBinary );\n\t\t\t\tbreak;\n\n\t\t\tcase 'transcode':\n\t\t\t\ttranscoderPending.then( () => {\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst { faces, buffers, width, height, hasAlpha, format, type, dfdFlags } = transcode( message.buffer );\n\n\t\t\t\t\t\tself.postMessage( { type: 'transcode', id: message.id, data: { faces, width, height, hasAlpha, format, type, dfdFlags } }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t} );\n\n\tfunction init( wasmBinary ) {\n\n\t\ttranscoderPending = new Promise( ( resolve ) => {\n\n\t\t\tBasisModule = { wasmBinary, onRuntimeInitialized: resolve };\n\t\t\tBASIS( BasisModule ); // eslint-disable-line no-undef\n\n\t\t} ).then( () => {\n\n\t\t\tBasisModule.initializeBasis();\n\n\t\t\tif ( BasisModule.KTX2File === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\tfunction transcode( buffer ) {\n\n\t\tconst ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );\n\n\t\tfunction cleanup() {\n\n\t\t\tktx2File.close();\n\t\t\tktx2File.delete();\n\n\t\t}\n\n\t\tif ( ! ktx2File.isValid() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file' );\n\n\t\t}\n\n\t\tlet basisFormat;\n\n\t\tif ( ktx2File.isUASTC() ) {\n\n\t\t\tbasisFormat = BasisFormat.UASTC;\n\n\t\t} else if ( ktx2File.isETC1S() ) {\n\n\t\t\tbasisFormat = BasisFormat.ETC1S;\n\n\t\t} else if ( ktx2File.isHDR() ) {\n\n\t\t\tbasisFormat = BasisFormat.UASTC_HDR;\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.KTX2Loader: Unknown Basis encoding' );\n\n\t\t}\n\n\t\tconst width = ktx2File.getWidth();\n\t\tconst height = ktx2File.getHeight();\n\t\tconst layerCount = ktx2File.getLayers() || 1;\n\t\tconst levelCount = ktx2File.getLevels();\n\t\tconst faceCount = ktx2File.getFaces();\n\t\tconst hasAlpha = ktx2File.getHasAlpha();\n\t\tconst dfdFlags = ktx2File.getDFDFlags();\n\n\t\tconst { transcoderFormat, engineFormat, engineType } = getTranscoderFormat( basisFormat, width, height, hasAlpha );\n\n\t\tif ( ! width || ! height || ! levelCount ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid texture' );\n\n\t\t}\n\n\t\tif ( ! ktx2File.startTranscoding() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader: .startTranscoding failed' );\n\n\t\t}\n\n\t\tconst faces = [];\n\t\tconst buffers = [];\n\n\t\tfor ( let face = 0; face < faceCount; face ++ ) {\n\n\t\t\tconst mipmaps = [];\n\n\t\t\tfor ( let mip = 0; mip < levelCount; mip ++ ) {\n\n\t\t\t\tconst layerMips = [];\n\n\t\t\t\tlet mipWidth, mipHeight;\n\n\t\t\t\tfor ( let layer = 0; layer < layerCount; layer ++ ) {\n\n\t\t\t\t\tconst levelInfo = ktx2File.getImageLevelInfo( mip, layer, face );\n\n\t\t\t\t\tif ( face === 0 && mip === 0 && layer === 0 && ( levelInfo.origWidth % 4 !== 0 || levelInfo.origHeight % 4 !== 0 ) ) {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( levelCount > 1 ) {\n\n\t\t\t\t\t\tmipWidth = levelInfo.origWidth;\n\t\t\t\t\t\tmipHeight = levelInfo.origHeight;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// Handles non-multiple-of-four dimensions in textures without mipmaps. Textures with\n\t\t\t\t\t\t// mipmaps must use multiple-of-four dimensions, for some texture formats and APIs.\n\t\t\t\t\t\t// See mrdoob/three.js#25908.\n\t\t\t\t\t\tmipWidth = levelInfo.width;\n\t\t\t\t\t\tmipHeight = levelInfo.height;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tlet dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );\n\t\t\t\t\tconst status = ktx2File.transcodeImage( dst, mip, layer, face, transcoderFormat, 0, - 1, - 1 );\n\n\t\t\t\t\tif ( engineType === EngineType.HalfFloatType ) {\n\n\t\t\t\t\t\tdst = new Uint16Array( dst.buffer, dst.byteOffset, dst.byteLength / Uint16Array.BYTES_PER_ELEMENT );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ! status ) {\n\n\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\tthrow new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tlayerMips.push( dst );\n\n\t\t\t\t}\n\n\t\t\t\tconst mipData = concat( layerMips );\n\n\t\t\t\tmipmaps.push( { data: mipData, width: mipWidth, height: mipHeight } );\n\t\t\t\tbuffers.push( mipData.buffer );\n\n\t\t\t}\n\n\t\t\tfaces.push( { mipmaps, width, height, format: engineFormat, type: engineType } );\n\n\t\t}\n\n\t\tcleanup();\n\n\t\treturn { faces, buffers, width, height, hasAlpha, dfdFlags, format: engineFormat, type: engineType };\n\n\t}\n\n\t//\n\n\t// Optimal choice of a transcoder target format depends on the Basis format (ETC1S, UASTC, or\n\t// UASTC HDR), device capabilities, and texture dimensions. The list below ranks the formats\n\t// separately for each format. Currently, priority is assigned based on:\n\t//\n\t//   high quality > low quality > uncompressed\n\t//\n\t// Prioritization may be revisited, or exposed for configuration, in the future.\n\t//\n\t// Reference: https://github.com/KhronosGroup/3D-Formats-Guidelines/blob/main/KTXDeveloperGuide.md\n\tconst FORMAT_OPTIONS = [\n\t\t{\n\t\t\tif: 'astcSupported',\n\t\t\tbasisFormat: [ BasisFormat.UASTC ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],\n\t\t\tengineType: [ EngineType.UnsignedByteType ],\n\t\t\tpriorityETC1S: Infinity,\n\t\t\tpriorityUASTC: 1,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'bptcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],\n\t\t\tengineType: [ EngineType.UnsignedByteType ],\n\t\t\tpriorityETC1S: 3,\n\t\t\tpriorityUASTC: 2,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'dxtSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],\n\t\t\tengineType: [ EngineType.UnsignedByteType ],\n\t\t\tpriorityETC1S: 4,\n\t\t\tpriorityUASTC: 5,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc2Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],\n\t\t\tengineType: [ EngineType.UnsignedByteType ],\n\t\t\tpriorityETC1S: 1,\n\t\t\tpriorityUASTC: 3,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc1Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC1_Format ],\n\t\t\tengineType: [ EngineType.UnsignedByteType ],\n\t\t\tpriorityETC1S: 2,\n\t\t\tpriorityUASTC: 4,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'pvrtcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],\n\t\t\tengineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],\n\t\t\tengineType: [ EngineType.UnsignedByteType ],\n\t\t\tpriorityETC1S: 5,\n\t\t\tpriorityUASTC: 6,\n\t\t\tneedsPowerOfTwo: true,\n\t\t},\n\t\t{\n\t\t\tif: 'bptcSupported',\n\t\t\tbasisFormat: [ BasisFormat.UASTC_HDR ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC6H ],\n\t\t\tengineFormat: [ EngineFormat.RGB_BPTC_UNSIGNED_Format ],\n\t\t\tengineType: [ EngineType.HalfFloatType ],\n\t\t\tpriorityHDR: 1,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\n\t\t// Uncompressed fallbacks.\n\n\t\t{\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.RGBA32, TranscoderFormat.RGBA32 ],\n\t\t\tengineFormat: [ EngineFormat.RGBAFormat, EngineFormat.RGBAFormat ],\n\t\t\tengineType: [ EngineType.UnsignedByteType, EngineType.UnsignedByteType ],\n\t\t\tpriorityETC1S: 100,\n\t\t\tpriorityUASTC: 100,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tbasisFormat: [ BasisFormat.UASTC_HDR ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.RGBA_HALF ],\n\t\t\tengineFormat: [ EngineFormat.RGBAFormat ],\n\t\t\tengineType: [ EngineType.HalfFloatType ],\n\t\t\tpriorityHDR: 100,\n\t\t\tneedsPowerOfTwo: false,\n\t\t}\n\t];\n\n\tconst OPTIONS = {\n\t\t[ BasisFormat.ETC1S ]: FORMAT_OPTIONS\n\t\t\t.filter( ( opt ) => opt.basisFormat.includes( BasisFormat.ETC1S ) )\n\t\t\t.sort( ( a, b ) => a.priorityETC1S - b.priorityETC1S ),\n\n\t\t[ BasisFormat.UASTC ]: FORMAT_OPTIONS\n\t\t\t.filter( ( opt ) => opt.basisFormat.includes( BasisFormat.UASTC ) )\n\t\t\t.sort( ( a, b ) => a.priorityUASTC - b.priorityUASTC ),\n\n\t\t[ BasisFormat.UASTC_HDR ]: FORMAT_OPTIONS\n\t\t\t.filter( ( opt ) => opt.basisFormat.includes( BasisFormat.UASTC_HDR ) )\n\t\t\t.sort( ( a, b ) => a.priorityHDR - b.priorityHDR ),\n\t};\n\n\tfunction getTranscoderFormat( basisFormat, width, height, hasAlpha ) {\n\n\t\tconst options = OPTIONS[ basisFormat ];\n\n\t\tfor ( let i = 0; i < options.length; i ++ ) {\n\n\t\t\tconst opt = options[ i ];\n\n\t\t\tif ( opt.if && ! config[ opt.if ] ) continue;\n\t\t\tif ( ! opt.basisFormat.includes( basisFormat ) ) continue;\n\t\t\tif ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;\n\t\t\tif ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;\n\n\t\t\tconst transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];\n\t\t\tconst engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];\n\t\t\tconst engineType = opt.engineType[ 0 ];\n\n\t\t\treturn { transcoderFormat, engineFormat, engineType };\n\n\t\t}\n\n\t\tthrow new Error( 'THREE.KTX2Loader: Failed to identify transcoding target.' );\n\n\t}\n\n\tfunction isPowerOfTwo( value ) {\n\n\t\tif ( value <= 2 ) return true;\n\n\t\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\n\n\t}\n\n\t/**\n\t * Concatenates N byte arrays.\n\t *\n\t * @param {Uint8Array[]} arrays\n\t * @return {Uint8Array}\n\t */\n\tfunction concat( arrays ) {\n\n\t\tif ( arrays.length === 1 ) return arrays[ 0 ];\n\n\t\tlet totalByteLength = 0;\n\n\t\tfor ( let i = 0; i < arrays.length; i ++ ) {\n\n\t\t\tconst array = arrays[ i ];\n\t\t\ttotalByteLength += array.byteLength;\n\n\t\t}\n\n\t\tconst result = new Uint8Array( totalByteLength );\n\n\t\tlet byteOffset = 0;\n\n\t\tfor ( let i = 0; i < arrays.length; i ++ ) {\n\n\t\t\tconst array = arrays[ i ];\n\t\t\tresult.set( array, byteOffset );\n\n\t\t\tbyteOffset += array.byteLength;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n};\n\n// Parsing for non-Basis textures. These textures may have supercompression\n// like Zstd, but they do not require transcoding.\n\nconst UNCOMPRESSED_FORMATS = new Set( [ RGBAFormat, RGBFormat, RGFormat, RedFormat ] );\n\nconst FORMAT_MAP = {\n\n\t[ VK_FORMAT_R32G32B32A32_SFLOAT ]: RGBAFormat,\n\t[ VK_FORMAT_R32G32_SFLOAT ]: RGFormat,\n\t[ VK_FORMAT_R32_SFLOAT ]: RedFormat,\n\n\t[ VK_FORMAT_R16G16B16A16_SFLOAT ]: RGBAFormat,\n\t[ VK_FORMAT_R16G16_SFLOAT ]: RGFormat,\n\t[ VK_FORMAT_R16_SFLOAT ]: RedFormat,\n\n\t[ VK_FORMAT_R8G8B8A8_SRGB ]: RGBAFormat,\n\t[ VK_FORMAT_R8G8B8A8_UNORM ]: RGBAFormat,\n\t[ VK_FORMAT_R8G8_SRGB ]: RGFormat,\n\t[ VK_FORMAT_R8G8_UNORM ]: RGFormat,\n\t[ VK_FORMAT_R8_SRGB ]: RedFormat,\n\t[ VK_FORMAT_R8_UNORM ]: RedFormat,\n\n\t[ VK_FORMAT_E5B9G9R9_UFLOAT_PACK32 ]: RGBFormat,\n\t[ VK_FORMAT_B10G11R11_UFLOAT_PACK32 ]: RGBFormat,\n\n\t[ VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK ]: RGBA_ETC2_EAC_Format,\n\t[ VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK ]: RGB_ETC2_Format,\n\t[ VK_FORMAT_EAC_R11_UNORM_BLOCK ]: R11_EAC_Format,\n\t[ VK_FORMAT_EAC_R11_SNORM_BLOCK ]: SIGNED_R11_EAC_Format,\n\t[ VK_FORMAT_EAC_R11G11_UNORM_BLOCK ]: RG11_EAC_Format,\n\t[ VK_FORMAT_EAC_R11G11_SNORM_BLOCK ]: SIGNED_RG11_EAC_Format,\n\n\t[ VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT ]: RGBA_ASTC_4x4_Format,\n\t[ VK_FORMAT_ASTC_4x4_SRGB_BLOCK ]: RGBA_ASTC_4x4_Format,\n\t[ VK_FORMAT_ASTC_4x4_UNORM_BLOCK ]: RGBA_ASTC_4x4_Format,\n\t[ VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT ]: RGBA_ASTC_6x6_Format,\n\t[ VK_FORMAT_ASTC_6x6_SRGB_BLOCK ]: RGBA_ASTC_6x6_Format,\n\t[ VK_FORMAT_ASTC_6x6_UNORM_BLOCK ]: RGBA_ASTC_6x6_Format,\n\n\t[ VK_FORMAT_BC1_RGBA_SRGB_BLOCK ]: RGBA_S3TC_DXT1_Format,\n\t[ VK_FORMAT_BC1_RGBA_UNORM_BLOCK ]: RGBA_S3TC_DXT1_Format,\n\t[ VK_FORMAT_BC1_RGB_SRGB_BLOCK ]: RGB_S3TC_DXT1_Format,\n\t[ VK_FORMAT_BC1_RGB_UNORM_BLOCK ]: RGB_S3TC_DXT1_Format,\n\n\t[ VK_FORMAT_BC3_SRGB_BLOCK ]: RGBA_S3TC_DXT3_Format,\n\t[ VK_FORMAT_BC3_UNORM_BLOCK ]: RGBA_S3TC_DXT3_Format,\n\n\t[ VK_FORMAT_BC4_SNORM_BLOCK ]: SIGNED_RED_RGTC1_Format,\n\t[ VK_FORMAT_BC4_UNORM_BLOCK ]: RED_RGTC1_Format,\n\n\t[ VK_FORMAT_BC5_SNORM_BLOCK ]: SIGNED_RED_GREEN_RGTC2_Format,\n\t[ VK_FORMAT_BC5_UNORM_BLOCK ]: RED_GREEN_RGTC2_Format,\n\n\t[ VK_FORMAT_BC7_SRGB_BLOCK ]: RGBA_BPTC_Format,\n\t[ VK_FORMAT_BC7_UNORM_BLOCK ]: RGBA_BPTC_Format,\n\n\t[ VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG ]: RGBA_PVRTC_4BPPV1_Format,\n\t[ VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG ]: RGBA_PVRTC_4BPPV1_Format,\n\t[ VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG ]: RGBA_PVRTC_2BPPV1_Format,\n\t[ VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG ]: RGBA_PVRTC_2BPPV1_Format,\n\n};\n\nconst TYPE_MAP = {\n\n\t[ VK_FORMAT_R32G32B32A32_SFLOAT ]: FloatType,\n\t[ VK_FORMAT_R32G32_SFLOAT ]: FloatType,\n\t[ VK_FORMAT_R32_SFLOAT ]: FloatType,\n\n\t[ VK_FORMAT_R16G16B16A16_SFLOAT ]: HalfFloatType,\n\t[ VK_FORMAT_R16G16_SFLOAT ]: HalfFloatType,\n\t[ VK_FORMAT_R16_SFLOAT ]: HalfFloatType,\n\n\t[ VK_FORMAT_R8G8B8A8_SRGB ]: UnsignedByteType,\n\t[ VK_FORMAT_R8G8B8A8_UNORM ]: UnsignedByteType,\n\t[ VK_FORMAT_R8G8_SRGB ]: UnsignedByteType,\n\t[ VK_FORMAT_R8G8_UNORM ]: UnsignedByteType,\n\t[ VK_FORMAT_R8_SRGB ]: UnsignedByteType,\n\t[ VK_FORMAT_R8_UNORM ]: UnsignedByteType,\n\n\t[ VK_FORMAT_E5B9G9R9_UFLOAT_PACK32 ]: UnsignedInt5999Type,\n\t[ VK_FORMAT_B10G11R11_UFLOAT_PACK32 ]: UnsignedInt101111Type,\n\n\t[ VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_EAC_R11_UNORM_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_EAC_R11_UNORM_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_EAC_R11G11_UNORM_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_EAC_R11G11_UNORM_BLOCK ]: UnsignedByteType,\n\n\t[ VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT ]: HalfFloatType,\n\t[ VK_FORMAT_ASTC_4x4_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_ASTC_4x4_UNORM_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT ]: HalfFloatType,\n\t[ VK_FORMAT_ASTC_6x6_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_ASTC_6x6_UNORM_BLOCK ]: UnsignedByteType,\n\n\t[ VK_FORMAT_BC1_RGBA_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_BC1_RGBA_UNORM_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_BC1_RGB_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_BC1_RGB_UNORM_BLOCK ]: UnsignedByteType,\n\n\t[ VK_FORMAT_BC3_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_BC3_UNORM_BLOCK ]: UnsignedByteType,\n\n\t[ VK_FORMAT_BC4_SNORM_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_BC4_UNORM_BLOCK ]: UnsignedByteType,\n\n\t[ VK_FORMAT_BC5_SNORM_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_BC5_UNORM_BLOCK ]: UnsignedByteType,\n\n\t[ VK_FORMAT_BC7_SRGB_BLOCK ]: UnsignedByteType,\n\t[ VK_FORMAT_BC7_UNORM_BLOCK ]: UnsignedByteType,\n\n\t[ VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG ]: UnsignedByteType,\n\t[ VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG ]: UnsignedByteType,\n\t[ VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG ]: UnsignedByteType,\n\t[ VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG ]: UnsignedByteType,\n\n};\n\nasync function createRawTexture( container ) {\n\n\tconst { vkFormat } = container;\n\n\tif ( FORMAT_MAP[ vkFormat ] === undefined ) {\n\n\t\tthrow new Error( 'THREE.KTX2Loader: Unsupported vkFormat: ' + vkFormat );\n\n\t}\n\n\t// TODO: Merge the TYPE_MAP warning into the thrown error above, after r190.\n\tif ( TYPE_MAP[ vkFormat ] === undefined ) {\n\n\t\tconsole.warn( 'THREE.KTX2Loader: Missing \".type\" for vkFormat: ' + vkFormat );\n\n\t}\n\n\t//\n\n\tlet zstd;\n\n\tif ( container.supercompressionScheme === KHR_SUPERCOMPRESSION_ZSTD ) {\n\n\t\tif ( ! _zstd ) {\n\n\t\t\t_zstd = new Promise( async ( resolve ) => {\n\n\t\t\t\tconst zstd = new ZSTDDecoder();\n\t\t\t\tawait zstd.init();\n\t\t\t\tresolve( zstd );\n\n\t\t\t} );\n\n\t\t}\n\n\t\tzstd = await _zstd;\n\n\t}\n\n\t//\n\n\tconst mipmaps = [];\n\n\tfor ( let levelIndex = 0; levelIndex < container.levels.length; levelIndex ++ ) {\n\n\t\tconst levelWidth = Math.max( 1, container.pixelWidth >> levelIndex );\n\t\tconst levelHeight = Math.max( 1, container.pixelHeight >> levelIndex );\n\t\tconst levelDepth = container.pixelDepth ? Math.max( 1, container.pixelDepth >> levelIndex ) : 0;\n\n\t\tconst level = container.levels[ levelIndex ];\n\n\t\tlet levelData;\n\n\t\tif ( container.supercompressionScheme === KHR_SUPERCOMPRESSION_NONE ) {\n\n\t\t\tlevelData = level.levelData;\n\n\t\t} else if ( container.supercompressionScheme === KHR_SUPERCOMPRESSION_ZSTD ) {\n\n\t\t\tlevelData = zstd.decode( level.levelData, level.uncompressedByteLength );\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.KTX2Loader: Unsupported supercompressionScheme.' );\n\n\t\t}\n\n\t\tlet data;\n\n\t\tif ( TYPE_MAP[ vkFormat ] === FloatType ) {\n\n\t\t\tdata = new Float32Array(\n\n\t\t\t\tlevelData.buffer,\n\t\t\t\tlevelData.byteOffset,\n\t\t\t\tlevelData.byteLength / Float32Array.BYTES_PER_ELEMENT\n\n\t\t\t);\n\n\t\t} else if ( TYPE_MAP[ vkFormat ] === HalfFloatType ) {\n\n\t\t\tdata = new Uint16Array(\n\n\t\t\t\tlevelData.buffer,\n\t\t\t\tlevelData.byteOffset,\n\t\t\t\tlevelData.byteLength / Uint16Array.BYTES_PER_ELEMENT\n\n\t\t\t);\n\n\t\t} else if ( TYPE_MAP[ vkFormat ] === UnsignedInt5999Type || TYPE_MAP[ vkFormat ] === UnsignedInt101111Type ) {\n\n\t\t\tdata = new Uint32Array(\n\n\t\t\t\tlevelData.buffer,\n\t\t\t\tlevelData.byteOffset,\n\t\t\t\tlevelData.byteLength / Uint32Array.BYTES_PER_ELEMENT\n\n\t\t\t);\n\n\t\t} else {\n\n\t\t\tdata = levelData;\n\n\t\t}\n\n\t\tmipmaps.push( {\n\n\t\t\tdata: data,\n\t\t\twidth: levelWidth,\n\t\t\theight: levelHeight,\n\t\t\tdepth: levelDepth,\n\n\t\t} );\n\n\t}\n\n\t// levelCount = 0 implies runtime-generated mipmaps.\n\tconst useMipmaps = container.levelCount === 0 || mipmaps.length > 1;\n\n\tlet texture;\n\n\tif ( UNCOMPRESSED_FORMATS.has( FORMAT_MAP[ vkFormat ] ) ) {\n\n\t\ttexture = container.pixelDepth === 0\n\t\t\t? new DataTexture( mipmaps[ 0 ].data, container.pixelWidth, container.pixelHeight )\n\t\t\t: new Data3DTexture( mipmaps[ 0 ].data, container.pixelWidth, container.pixelHeight, container.pixelDepth );\n\t\ttexture.minFilter = useMipmaps ? NearestMipmapNearestFilter : NearestFilter;\n\t\ttexture.magFilter = NearestFilter;\n\t\ttexture.generateMipmaps = container.levelCount === 0;\n\n\t} else {\n\n\t\tif ( container.pixelDepth > 0 ) throw new Error( 'THREE.KTX2Loader: Unsupported pixelDepth.' );\n\n\t\ttexture = new CompressedTexture( mipmaps, container.pixelWidth, container.pixelHeight );\n\t\ttexture.minFilter = useMipmaps ? LinearMipmapLinearFilter : LinearFilter;\n\t\ttexture.magFilter = LinearFilter;\n\n\t}\n\n\ttexture.mipmaps = mipmaps;\n\n\ttexture.type = TYPE_MAP[ vkFormat ];\n\ttexture.format = FORMAT_MAP[ vkFormat ];\n\ttexture.colorSpace = parseColorSpace( container );\n\ttexture.needsUpdate = true;\n\n\t//\n\n\treturn Promise.resolve( texture );\n\n}\n\nfunction parseColorSpace( container ) {\n\n\tconst dfd = container.dataFormatDescriptor[ 0 ];\n\n\tif ( dfd.colorPrimaries === KHR_DF_PRIMARIES_BT709 ) {\n\n\t\treturn dfd.transferFunction === KHR_DF_TRANSFER_SRGB ? SRGBColorSpace : LinearSRGBColorSpace;\n\n\t} else if ( dfd.colorPrimaries === KHR_DF_PRIMARIES_DISPLAYP3 ) {\n\n\t\treturn dfd.transferFunction === KHR_DF_TRANSFER_SRGB ? DisplayP3ColorSpace : LinearDisplayP3ColorSpace;\n\n\t} else if ( dfd.colorPrimaries === KHR_DF_PRIMARIES_UNSPECIFIED ) {\n\n\t\treturn NoColorSpace;\n\n\t} else {\n\n\t\tconsole.warn( `THREE.KTX2Loader: Unsupported color primaries, \"${ dfd.colorPrimaries }\"` );\n\t\treturn NoColorSpace;\n\n\t}\n\n}\n\nexport { KTX2Loader };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}